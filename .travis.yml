language: php

php:
  - 5.4
  - 5.5
  - 5.6
env:
  - WP_VERSION="~4.0"

services:
  - mysql

before_script:
  - mysql -e 'create database wordpress;'
  - curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar
  - chmod +x wp-cli.phar
  - php wp-cli.phar core config --dbname=wordpress --dbuser=travis
  - php wp-cli.phar core install --url=http://localhost:80 --title=test --admin_user=phill --admin_password=password --admin_email=phill@phillprice.com
  - sed -i.bak s#behat_dbuser#travis#g behat.yml
  - sed -i.bak s#behat_dpass##g behat.yml
  - sed -i.bak s#port#80#g behat.yml
  - cp .travis.composer.json composer.json                       # override normal composer file: use one without wordpress
  - rm composer.lock
  - composer install --no-interaction --prefer-source            # Have to prefer source or hit github rate limit
  - php -S localhost:80 -t vendor/wordpress &> /dev/null &     # webserver setup, ignore web server request log
  - sleep 3                                                      # wait for the built in web server

script:
  - vendor/bin/behat                                             # run behat
